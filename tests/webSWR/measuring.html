<!DOCTYPE HTML>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Highcharts Example</title>

		<style type="text/css">
.ld-label {
	width:200px;
	display: inline-block;
}

.ld-row {
}

.ld-url-input {
	width: 500px; 
}

.ld-time-input {
	width: 40px;
}

		</style>
	</head>
	<body>
<script src="/hc/code/highcharts.js"></script>

<div id="container" style="min-width: 310px; height: 400px; margin: 0 auto"></div>

<div class="ld-row">
	<label class="ld-label">
		Enable Polling
	</label>
	<input type="checkbox" checked="checked" id="enable WS"/>
</div>


<script type="text/javascript">
    var ip = location.host;
  	var ws_Url = "ws://" + ip + "/ws/";
    var intervalSendWatchdog;

	
    // Send a message on the WebSocket.
    function sendMessage(msg) {  
		if(ws!= null)
		{
			ws.send(msg);
			console.log("Alive msg sent");  
		}
    }

    // Setup WebSocket connection and event handlers
    function setup() {  
        
		ws = new WebSocket(ws_Url);
		
        // Listen for the connection open event then call the sendMessage function          
        ws.onopen = function (e) {      
            console.log("Connected");
			intervalSendWatchdog = setInterval(function(){ sendMessage("{}"); }, 5000);
        }

        // Listen for the close connection event
        ws.onclose = function (e) {      
            console.log("OnClose recieved - WS disconnected");
			clearInterval(intervalSendWatchdog);
  			ws = null;
      }

        // Listen for connection errors
        ws.onerror = function (e) {      
            console.log("Error ");  // ToDo: What shall we do with a drunken error...
        }

        // Listen for new messages arriving at the client
        ws.onmessage = function (e) {      
	    	//var request = (e.data).split(",");
			//val = e.data;
			console.log(e.data);
			val = JSON.parse(e.data);
			console.log(val);
			chart.series[0].setData(val, true);
        }
    }

	var chart = Highcharts.chart('container', {
		chart: { 
			animation: false,
	        type: 'column'
		},
		series: [{
			data: [29.9, 71.5, 106.4, 129.2, 144.0, 176.0, 135.6, 148.5, 216.4, 194.1, 95.6, 54.4]
		}]
	});

	// Create the chart
	setup();

		</script>
	</body>
</html> 